angular.module("admin.services",[]).factory("API",function($http){return{users:function(){return $http.get("/api/users")},user:function(username){return $http.get("/api/users/"+username)},events:function(){return $http.get("/api/events")}}}).factory("DATA",function(){try{localStorage.dataTestValue=0,delete localStorage.dataTestValue}catch(e){return void alert("Unable to access the browser local storage. Check that the incognito mode is disabled.")}var data={},persist=function(){localStorage.myAppPersistentData=JSON.stringify(data)},restore=function(){localStorage.myAppPersistentData&&(data=JSON.parse(localStorage.myAppPersistentData))};return restore(),data.persist=persist,data.restore=restore,data});var app=angular.module("admin",["ui.bootstrap","ngCookies","ngRoute","ngAnimate","admin.services"]);app.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"views/splash.html",controller:"SplashCtrl"}).when("/summary",{templateUrl:"views/summary.html",controller:"SummaryCtrl"}).when("/users",{templateUrl:"views/jugadors.html",controller:"ListCtrl"}).when("/users/:nick",{templateUrl:"views/jugador.html",controller:"PlayerCtrl"}).when("/activity",{templateUrl:"views/activity.html",controller:"ActivityCtrl"}).when("/referers",{templateUrl:"views/referers.html",controller:"ReferersCtrl"}).when("/referers/:nick",{templateUrl:"views/jugador.html",controller:"RefererCtrl"}).otherwise({redirectTo:"/summary"})}),app.directive("loading",function(){return{restrict:"AE",replace:"false",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'}}),app.controller("MainCtrl",function($scope,$cookieStore){var toggleThreshold=992;$scope.breadcrumbs="Home / Summary",$scope.getWidth=function(){return window.innerWidth},$scope.$watch($scope.getWidth,function(newValue){$scope.toggle=newValue>=toggleThreshold?angular.isDefined($cookieStore.get("toggle"))?!!$cookieStore.get("toggle"):!0:!1}),$scope.toggleSidebar=function(){$scope.toggle=!$scope.toggle,$cookieStore.put("toggle",$scope.toggle)},window.onresize=function(){$scope.$apply()}}),app.controller("SplashCtrl",function($scope){$scope.$parent.breadcrumbs="Home"}),app.controller("SummaryCtrl",function($scope){$scope.$parent.breadcrumbs="Home / Summary"}),app.controller("ListCtrl",function($scope,API,DATA){$scope.$parent.breadcrumbs="Home / Users",API.users().success(function(obj,status){if(200!=status)return void(location.hash="/");if("object"==typeof obj){$scope.users=[];for(var i=0;i<obj.length;i++)obj[i].data=new Date(obj[i].data),$scope.users.push(obj[i]);DATA.users=obj}}).error(function(){alert("Unable to connect to the server")})}),app.controller("ReferersCtrl",function($scope){$scope.$parent.breadcrumbs="Home / Referers"});var makeUserController=function(sectionOrigin){return function($scope,$routeParams,API){$scope.user=null,$scope.referers=[],$scope.origin=sectionOrigin,$scope.$parent.breadcrumbs="users"==sectionOrigin?"Home / Users / "+$routeParams.nick:"Home / Referers / "+$routeParams.nick,API.user($routeParams.nick).success(function(obj,status){return 200!=status||"object"!=typeof obj?void(location.hash="/users"):($scope.user=obj,void($scope.user.created=new Date($scope.user.created)))}).error(function(){alert("Unable to connect to the server")})}};app.controller("PlayerCtrl",makeUserController("users")),app.controller("RefererCtrl",makeUserController("referers")),app.controller("ActivityCtrl",function($scope,API,DATA){$scope.gameEvents=DATA.gameEvents||[],$scope.accountEvents=DATA.accountEvents||[],$scope.$parent.breadcrumbs="Home / Activity",$scope.loadData=function(){API.events().success(function(obj,status){if(200!=status)return void(location.hash="/");if("object"==typeof obj){$scope.gameEvents=[],$scope.accountEvents=[];for(var i=0;i<obj.length;i++)obj[i].data=new Date(obj[i].data),"registre"==obj[i].tipus||"dades"==obj[i].tipus?$scope.accountEvents.push(obj[i]):$scope.gameEvents.push(obj[i]);DATA.gameEvents=$scope.gameEvents,DATA.accountEvents=$scope.accountEvents}}).error(function(){alert("Unable to connect to the server")})},$scope.loadData()});